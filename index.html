<!doctype html><html><head><meta name="viewport"content="width=device-width,initial-scale=1"><style>*{box-sizing:border-box;transition:transform 180ms}html,body{font-size:14px;user-select:none;font-family:Helvetica;overscroll-behavior-y:contain}@media (min-width:600px){body{font-size:16px}}</style></head><body><canvas id="u"style="position:fixed;bottom:0;left:0;width:100%;height:100%"></canvas><div id="d"style="position:fixed;border-radius:0 0 0 20px;padding:10px;background:#dddc;top:0;right:0;min-width:80px;font-size:1.2em"></div><div id="a"style="position:fixed;border-radius:20px 0 0 0;padding:10px;background:#dddc;bottom:0;right:0;min-width:100px;height:60px;display:flex;flex-direction:row"> <button id="b"style="padding:10px">open shop</button> <button id="c"style="padding:10px">× cancel</button></div><div id="e"style="position:fixed;border-radius:4px;max-width:40rem;width:calc(100% - 20px);right:10px;height:250px;bottom:10px;transform-origin:bottom;display:flex;flex-direction:row"> <div id="f"style="width:30%;min-width:100px;background:#dddc;flex-shrink:0.3"></div> <div style="padding:10px;background:#fffc;flex-grow:1;display:flex;flex-direction:column"> <div id="h"style="font-weight:bold;margin:10px"></div> <div style="display:flex;flex-direction:row;position:relative;align-items:center;justify-content:space-around"> <canvas id="j"width="100px"height="100px"style="width:100px;height:100px;cursor:pointer"></canvas> <div id="i"style="font-size:1.2em"></div> <button id="l"style="font-size:1.2em;position:absolute;bottom:-14px;left:-4px">↻</button> </div> <canvas id="k"width="220"height="50"style="width:220px;height:50px;margin:auto;margin-bottom:0"></canvas> </div> <button id="g"style="font-size:30px;padding:4px 10px;position:absolute;top:2px;right:2px;z-index:3;background:#0000;border:none">×</button></div><div id="o"style="position:fixed;right:10px;bottom:0;font-size:1.8em;line-height:40px;z-index:3;font-weight:bold"></div><div id="m"style="position:fixed;top:0;left:0;right:0;bottom:0;background-color:#000d;transition:background-color 200ms;display:flex;justify-content:center;align-items:center;z-index:3"> <div id="n"style="color:#fff;font-size:2em;line-height:2em;padding:10%"></div></div><script>const e=({x:a,y:b})=>({x:Math.floor(a),y:Math.floor(b)}),d=({x:a,y:b})=>({x:Math.floor(a)+.5,y:Math.floor(b)+.5}),f=(a,b)=>a.x==b.x&&a.y==b.y,a=a=>a.x*a.x+a.y*a.y,g=b=>Math.sqrt(a(b)),b=a=>{const b=g(a);return{x:a.x/b,y:a.y/b}},i=(b,c)=>a({x:b.x-c.x,y:b.y-c.y}),c=(a,b)=>Math.sqrt(i(a,b)),j=(a,b,c,d=0)=>{const e=c.x-a.x,f=c.y-a.y,g=e*b.x+f*b.y,h=Math.min(1-d,Math.max(d,g));return{x:a.x+b.x*h,y:a.y+b.y*h}},n=[{x:0,y:1},{x:1,y:1},{x:1,y:0},{x:1,y:-1},{x:0,y:-1},{x:-1,y:-1},{x:-1,y:0},{x:-1,y:1}],q=[{x:0,y:1},{x:1,y:0},{x:0,y:-1},{x:-1,y:0}],k=1e-5,m=(c,d,g)=>{const h=e(d),a=e(g);if(!c(h))return!1;if(f(h,a))return!0;const b=g.x-d.x,i=g.y-d.y,j=(d.x%1+1)%1,l=(d.y%1+1)%1,n=0<=b?(1-j)/b:-j/b,o=0<=i?(1-l)/i:-l/i,p=Math.min(n,o)+k,q={x:d.x+p*b,y:d.y+p*i};return m(c,q,g)},p=(a,{x:b,y:c})=>0<=b&&b<C(a)&&0<=c&&c<z(a),r=(a,b)=>{const c=u(a,b);return 1!==c&&3!==c},o=(a,b)=>1!==u(a,b),t=(a,b)=>0===u(a,b),u=(a,b)=>p(a,b)?a[b.y][b.x]:1,v=(a,b,c)=>a[b.y][b.x]=c,z=a=>a.length,C=a=>a[0].length,D=(c,a)=>Math.abs(c.x-a.x)+Math.abs(c.y-a.y),E=(a,[b,...c])=>{if(!b)return[];for(const e=c=>m(b=>r(a,b),d(b),d(c));c[1]&&e(c[1]);)c.shift();return[b,...E(a,c)]},A=b=>b?[...A(b.parent),b.c]:[],F=(c,a)=>c.f-a.f,G=(a,b,f)=>{const c=D(b,f),g=[{c:b,parent:null,a:0,f:c,d:c}],d=[];for(;g.length;){const b=g.shift();if(!b.d)return A(b);d.push(b.c),q.forEach(e=>{const h={x:e.x+b.c.x,y:e.y+b.c.y};if(r(a,h)&&!d.some(a=>!D(a,h))){const a=g.find(a=>!D(a.c,h));if(!a){const a=D(h,f);g.push({c:h,parent:b,a:b.a+1,d:a,f:b.a+1+a})}else a.d=D(h,f),a.f=a.a+a.d}}),g.sort(F)}return null},H=({b:a,c:b})=>c=>{const d=q[b];return{x:a.x+c.x*d.x+c.y*d.y,y:a.y+c.x*d.y-c.y*d.x}},B=(a,b,e,f=0)=>{let g=1/0,h=null;const c=H(b);for(let d=C(b.e.d);d--;)for(let k=z(b.e.d);k--;){const b=c({x:d,y:k});if(!r(a,b))for(let c=q.length;c--;){const k=q[c],d={x:b.x+k.x,y:b.y+k.y};if(r(a,d)){const a={x:b.x+.5+.5*k.x+.5*k.y,y:b.y+.5+.5*k.y-.5*k.x},l={x:-k.y,y:k.x},m=j(a,l,e,.12);m.x+=k.x*f,m.y+=k.y*f;const c=i(m,e);c<g&&(g=c,h=m)}}}return h},I=a=>a.targetTouches&&a.targetTouches[0]?{x:a.targetTouches[0].clientX,y:a.targetTouches[0].clientY}:{x:a.clientX||0,y:a.clientY||0},J=[{id:"Rice Grain Harvester",d:[[1,0],[3,0],[1,1]],f:300,g:14,h:{i:[],j:[{k:2,n:1}]},i:[],j:[{l:{x:1,y:0},k:2}]},{id:"Rice Cooker",d:[[0,1,0],[0,3,1],[0,1,0]],f:400,g:20,h:{i:[{k:2,n:2}],j:[{k:3,n:1}]},i:[{l:{x:2,y:0},k:2},{l:{x:2,y:2},k:2}],j:[{l:{x:0,y:1},k:3}]},{id:"Tuna Fishing Spot",d:[[0,1,1,1],[0,1,3,1],[0,1,1,1],[0,0,0,0]],f:1500,g:16,h:{i:[],j:[{k:4,n:1}]},i:[],j:[{l:{x:0,y:1},k:4}]},{id:"Sushi Roller",d:[[0,1,1],[0,3,1],[0,0,0]],f:5e3,g:20,h:{i:[{k:3,n:2},{k:4,n:1}],j:[{k:1,n:1}]},i:[{l:{x:2,y:2},k:4},{l:{x:2,y:2},k:3}],j:[{l:{x:0,y:1},k:1}]}],K=.2,L=.006,M=4e-4,N=.18,O=16e-5,P={2:15,3:50,4:30,1:200},Q=26,R=60,S=10,T=.1,U=20,V=200,W=.45,X=(a,b)=>c=>{if(b.m)return;const d=a.n.find(({o:a})=>i(a,c)<W*W),e=d?d.id:null;b.p!==e&&(b.p=e,e&&(b.m={}))};var Y=Object.freeze({onpointerdown:X});const Z=(a,b)=>(c,d)=>{if(b.m){const c=a.q.find(a=>aa(a,d));if(c){const d=a.n.find(a=>a.id===b.p);d.r&&d.r.s&&a.t.push({u:Q,k:d.r.s,o:{x:d.o.x,y:d.o.y}}),d.m={v:3,w:c.id},d.r={x:0},d.y=null,b.m=null,b.p=null}else r(a.map,d)?(b.m.v=2,b.m.z=d):(b.m=null,b.p=null)}},$=(a,b)=>(a,c)=>{b.m&&b.m.z&&(b.m.A=c)},_=(a,b)=>()=>{if(b.m&&b.m.A){const c=G(a.map,b.m.z,b.m.A);if(c){const c=a.n.find(a=>a.id===b.p);c.m={v:2,A:b.m.A,z:b.m.z},c.r={s:c.r&&c.r.s},c.y=null}b.m=null,b.p=null}},aa=(a,b)=>{const c=a.e;for(let d=C(c.d);d--;)for(let e=z(c.d);e--;)if(!r(c.d,{x:d,y:e})&&f(b,H(a)({x:d,y:e})))return!0;return!1};var ba=Object.freeze({onpointerdown:Z,onpointermove:$,onpointerup:_});const ca=(a,b)=>(c,d)=>{const e=b.B;e&&(e.o.x=c.x,e.o.y=c.y,b.C=r(a.map,d))},da=(a,b)=>()=>{if(b.B){if(!b.C)return void(b.B=null);const c=b.B;a.D-=V,a.n.push(c),b.B=null,b.E=!1,b.p=null}};var ea=Object.freeze({onpointermove:ca,onpointerup:da});const fa=(a,c)=>(d,e)=>{var f=Math.min,g=Math.floor;const i=c.F;if(!i)return;i.b.x=e.x,i.b.y=e.y;const j=C(i.e.d),k=z(i.e.d),h=H(i)({x:0,y:0}),l=H(i)({x:j-1,y:k-1}),b={x:f(h.x,l.x)+g(j/2),y:f(h.y,l.y)+g(j/2)};i.b.x+=e.x-b.x,i.b.y+=e.y-b.y;const m=H(i);c.G=!0;for(let b=j;b--;)for(let d=k;d--;){const e={x:b,y:d};c.G=c.G&&(r(i.e.d,e)||t(a.map,m(e)))}c.G=c.G&&[...i.e.j,...i.e.i].every(({l:b})=>t(a.map,m(b)))},ga=(a,b)=>()=>{if(!b.F)return;if(!b.G)return void(b.F=null);const c=b.F;a.D-=c.e.f;const d=H(c),e=C(c.e.d),f=z(c.e.d);for(let b=e;b--;)for(let e=f;e--;)r(c.e.d,{x:b,y:e})||v(a.map,d({x:b,y:e}),3);[...c.e.j,...c.e.i].every(({l:b})=>v(a.map,d(b),2)),a.q.push(c),b.F=null,b.E=!1,a.n.forEach(a=>a.y=null)};var ha=Object.freeze({onpointermove:fa,onpointerup:ga});const ia=[ba,ea,ha,Y],ja=(a,b,c)=>{let d,f=!1;const g=a=>g=>{if(!!g.touches)f=!0;else if(f)return;const i=d(I(g)),j=e(i);a.filter(Boolean).forEach(a=>a(b,c)(i,j,g))},h=()=>{const a=C(b.map),c=z(b.map),e=window.innerWidth,f=window.innerHeight,g=Math.min(e/a,f/c),h=e/g,i=f/g;d=({x:b,y:d})=>({x:b/e*h-(h-a)/2,y:d/f*i-(i-c)/2})};window.addEventListener("resize",h),h();const i=g(ia.map(a=>a.onpointerdown));a.onmousedown=a.ontouchstart=b=>{i(b),a.onmousemove(b),a.ontouchmove(b)},a.onmousemove=a.ontouchmove=g(ia.map(a=>a.onpointermove)),a.onmouseup=a.ontouchend=g(ia.map(a=>a.onpointerup))},ka="#fff",la="#000",ma="#888",na="#bbb",oa="#d2af80",pa="#c3a172",qa="#b97f36",ra="#d0963f",sa="#bd4521",ta="#bd2145",ua="#66a0a2",va="#a6cebf",wa=document.createElement("canvas"),xa=wa.width=wa.height=1024,l=wa.getContext("2d"),ya={x:0,y:0,H:0,I:12},za=(a,b)=>{ya.x+a>ya.I&&(ya.x=0,ya.y+=ya.H,ya.H=0);const c=[ya.x/ya.I,ya.y/ya.I,a/ya.I,b/ya.I];return ya.H=Math.max(ya.H,b),ya.x+=a,c},Aa={},Ba=(a,b,c,d,e=16,f=!1)=>{l.save(),l.filter=f&&"grayscale(100%)",l.translate(d[0]*xa,d[1]*xa);const g=e+4;l.scale(d[2]*xa/(c[2]+g),d[3]*xa/(c[3]+g)),l.translate(g/2,g/2),l.strokeStyle=la,l.lineCap="round",l.lineJoin="round",l.lineWidth=e,a.forEach(a=>l.stroke(new Path2D(a))),l.lineWidth=.8,a.forEach((a,c)=>{l.strokeStyle=l.fillStyle=b[c],l.fill(new Path2D(a)),l.stroke(new Path2D(a))}),l.restore()},Ca=([a,b,c,d])=>[a,b,a+c,b,a+c,b+d,a,b+d],Da=(a,b)=>Aa[a]=Ca(b),Ea=[0,0,100,100],Fa=["M96 27l2-7v-4l-7-1-15 6-9 4-6 4-22 18-10 10C17 68 10 77 7 82c-2 3-2 6-2 8s1 4 3 5c1 2 3 3 5 3l9-2 11-7 16-12v1l27-24 8-8c6-5 10-12 12-19zm0 0"];let Ga=za(1,1);Ba(Fa,[qa],Ea,[Ga[0],Ga[1]+0*Ga[2],Ga[2],.7*Ga[3]],16),Ba(Fa,[ra],Ea,[Ga[0],Ga[1]+.2*Ga[2],Ga[2],.7*Ga[3]],16),Da(2,Ga),Ga=za(1,1),Ba(Fa,[qa],Ea,[Ga[0],Ga[1]+0*Ga[2],Ga[2],.7*Ga[3]],16,!0),Ba(Fa,[ra],Ea,[Ga[0],Ga[1]+.2*Ga[2],Ga[2],.7*Ga[3]],16,!0),Da(12,Ga);const Ha=[0,0,100,100],Ia=["M44 100c5 0 9-1 13-3h-5c-12 2-21-3-27-15-6-13-10-27-12-41-2-12 2-22 10-29C33 3 44-1 57 1 44-2 32 0 20 7 8 13 1 24 0 40s3 30 11 42c8 13 19 19 33 18zm0 0","M76 35c-6-7-12-7-17 0-8 10-13 21-16 33l3 3c8 8 16 15 25 20l1-1c12-6 20-16 24-30-6-10-12-18-20-25zm0 0","M61 2l-4-1C44-1 33 3 23 12c-8 7-12 17-10 29 2 14 6 28 12 41 6 12 15 17 27 15h5c5 0 9-2 13-5l1-1c-9-5-17-12-25-20l-3-3c3-12 8-23 16-33 5-7 11-7 17 0 8 7 14 15 20 25 8-14 6-27-3-40C84 8 74 2 61 2zm0 0"];let Ja=za(1,1);Ba(Ia,[sa,ta,qa],Ha,Ja,16),Da(3,Ja),Ja=za(1,1),Ba(Ia,[sa,ta,qa],Ha,Ja,16,!0),Da(13,Ja);const Ka=[0,0,100,100],La=["M16 12v-1l-2 4C9 22 6 30 2 39c-2 7-2 14 0 21 2 6 4 10 8 13 4 2 8 4 12 4l4 1 6 1c11 5 22 11 32 19 3 2 5 3 8 3 4 0 7-2 11-5l8-8c5-7 9-15 10-25v-1l-1-8-2-2-2-2-3-2-20-8-13-5-16-6-13-5-15-5v-3l-1-1h1v-3zm0 0","M72 19l-14-7-15-6-12-5c-6-2-12 0-16 7A815 815 0 0 0 1 35C0 45 3 51 11 51l19 1 15 4 14 6 3 2 10 7 10 11 2-3 12-18c4-6 5-12 2-18-2-7-6-12-11-15l-15-9zm0 0","M34 2l-4 6-5 8c-5 4-9 9-12 15-2 2-3 5-2 8v12l4 1-1-4c-1-9 1-16 6-20s9-10 12-16l5-7 1-1-4-2m65 42l-1-1-1-3-6 6c-4 5-8 9-13 12l-3 3-3 11 4 3v-3l1-5c2-4 5-8 8-10 3-1 6-4 8-7l6-6M89 29l-2-1-2-2-5 5-5 4-5 3-6 4-5 4-2 2-1 3v10l3 1v-1-7l1-3 4-4 6-3 6-4 5-4 5-5 3-2m-24-9l-2 1-14 10-4 4c-3 3-5 6-4 11v9l4 1-1-6 1-5c3-7 7-12 12-14 5-3 9-6 13-11l1-1-4-2-2 3M53 10l-5-2-2 2-5 5-5 5-2 3-4 7-2 3c-1 0-2 1-2 3l-1 3v10l1 3h3v-1l-1-10v-2l2-2 4-6 3-5 5-6 5-5 5-4zm0 0"];let Ma=za(1,1);Ba(La,[sa,ta,qa],Ka,Ma,16),Da(1,Ma),Ma=za(1,1),Ba(La,[sa,ta,qa],Ka,Ma,16,!0),Da(11,Ma);const Na=[0,0,100,100],Oa=["M21 2h-3L2 13c-3 5-3 10-3 16l2 18 5 11 10 7 12 7 22 11c5 0 9 0 14-3 3-2 6-2 9 2l5 7c2 6 6 9 11 10h1l3-12c0-7 0-13 3-19l4-17c1-4 0-6-2-7-5-3-10-2-14 1s-6 2-8-3l-9-14-8-10c-3-3-6-6-10-7-9-4-18-7-28-9zm0 0","M24 14c0-2-2-4-3-4-5-2-8-1-10 4l-1 5 2 5 2 1c5 2 8 1 10-5v-6m-5 8l-1 1 2-3-1 2m58 39v-1l-1-1-5-3-5-2-33-17h-1l-2 2 2 2 43 22h2v-2M29 16l-2 1v4l-1 7-1 6-2 7-3 6-1 1-3 2v3l1 1 2-1 1-1 1-1 2-3 3-7 2-7 2-7V17l-1-1m4 63c2-2 2-4 1-7l-1-1c-5-5-11-8-17-8l2 8c1 2 2 5 4 6 2 3 5 4 8 4 2 0 3 0 3-2m5-68l12 6c6 3 12 7 17 13h1c3-4 3-8 0-12l-5-5C55 6 46 1 36 0c-4 0-9 1-13 4v1zm0 0"];let Pa=za(1,1);Ba(Oa,[sa,ta,qa],Na,Pa,16),Da(4,Pa),Pa=za(1,1),Ba(Oa,[sa,ta,qa],Na,Pa,16,!0),Da(14,Pa);const Qa=[0,0,100,100],Ra=[["M50 56h-7q0 5 3 7 3 3 7 3 3 0 4-2l1-8h-8m-26-7q-2-3-2-7l-3 12-1 14q0 11 7 18 0-8 3-16l2-8 2-8-6-3-2-2m59 19q0-14-2-23l-1-1-1-1-1 4-3 5-2 1 7 21 1 7q2-5 2-13z","M28 70q-3 8-3 16l-1 5q0 3 3 5 5 3 18 3h19q7 0 11-2 3-1 5-5l1-10v-1l-1-7-7-21-15 3-1 8q-1 2-4 2-4 0-7-3-3-2-3-7l-11-2-2 8-2 8z","M70 38l-13 1-22 1q-9 0-13-6l-1 5 1 3q0 4 2 7l2 2 6 3 11 2h15l15-3 2-1 3-5 1-4-4-3q-2-2-5-2z","M93 28l-3-7-4-7Q82 8 70 4 59 0 46 0 30 0 24 5q-7 5-4 26v2l1 1h1q4 6 13 6l22-1 13-1q3 0 5 2l4 3 1 1 1 1 3 3 5 1 4-2q2-2 2-6l-1-6-1-7z"],["M73 58l1 2v-7q-4 4-13 5l1 1q1 2 4 2l4-2 3-1M33 37v-2l-1-1-3 1-2 3-1 6-2 9q-3 12-3 20 0 15 12 20l3-6 7-10 3-8 3-11-5-1h-1-1q-4-1-6-4h-1l-2-5V38v-1z","M34 95l2 1 9 2 8 1 9-2 7-7q4-4 6-9l2-9-2-10-1-2-1-2-3 1-4 2q-3 0-4-2l-1-1H49l-3 11-3 8-7 10-3 6 1 2z","M77 33q-7 4-28 4l-12-1-4-1v13l2 5h1q2 3 6 4h2l5 1h12q9-1 13-5v-1l1-1q3-4 3-11v-3-5l-1 1z","M49 37q21 0 28-4l1-1 3-3v-3l-1-6-5-7q-7-9-21-9-12 0-20 5l-6 5-2 4v2l1 2 2 2 2 3v6l1 1 1 1 4 1 12 1z"],["M81 47l-1-4-2 1v3q-1 4-4 6t-11 3l-2 3q-3 2-7 2l-14-1q-3-1-6-5l-7-3-3-3-1-1h-1l-2-2-2 12-1 11q0 9 5 15l3 4q9 8 26 8 18 0 25-7l4-5q3-6 3-16 0-11-2-21z","M34 55q3 4 6 5l14 1q4 0 7-2l2-3-14 1q-9 0-15-2z","M78 44l-1 1q-6 5-14 5H33l-10-2 1 1 3 3 7 3q6 2 15 2l14-1q8-1 11-3t4-6v-3z","M78 10q-8-6-27-6L23 5Q12 13 8 22q-3 6-3 12 0 4 2 7 2 4 7 4l2-1h3l1 2 2 2h1l10 2h30q8 0 14-5l1-1 2-1q4-6 4-15 0-12-6-18z"],["M32 57l-2-3-3-1v8l2-1 3-3m42-19v-1q-2 13-8 20l-7 7-7 1h-4l2 4q4 9 8 13l6 7 1 3v3l9-5q6-6 6-17l-2-20-4-15z","M33 58l-1-1-3 3-2 1q-3 4-3 9 0 12 8 21 8 7 20 7 7 0 11-2l2-1v-3l-1-3-6-7q-4-4-8-13l-2-4q-9-1-15-7z","M26 31l-2-2-1 7v8l3 6 1 3 3 1q-3-6-3-16v-4l-1-3z","M69 13q-7-7-24-7-7 0-14 5-8 5-8 13l1 5 2 2 1 3v4q0 10 3 16l2 3 1 1q6 6 15 7h4l7-1 7-7q6-7 8-20V27q0-9-5-14z"]];let Sa;[0,1,2,3].forEach(a=>{Sa=za(1,1),Ba(Ra[a],[sa,oa,va,pa],Qa,Sa,10),Da(100+a,Sa),Sa=za(1,1),Ba(Ra[a],[ma,ma,va,ma],Qa,Sa,10),Da(300+a,Sa)});const Ta=()=>{l.beginPath(),l.arc(50,50,28,0,2*Math.PI),l.moveTo(22.5,42),l.lineTo(50,5),l.lineTo(77.5,42),l.fill()};let Ua;const Va=a=>(Ua=za(a,a),l.save(),l.scale(xa/(100*ya.I),xa/(100*ya.I)),l.translate(100*Ua[0]*ya.I,100*Ua[1]*ya.I),l.fillStyle=na,Ca(Ua)),Wa=Va(1);l.fillStyle=na,l.beginPath(),l.arc(50,50,28,0,2*Math.PI),l.fill(),l.restore();const Xa=Va(1);Ua=za(1,1),l.fillStyle=ka,l.beginPath(),l.arc(50,50,30,0,2*Math.PI),l.fill(),l.restore();const Ya=Va(1);l.fillStyle=na,Ta(),l.restore();const Za=Va(1);l.fillStyle=na,l.beginPath(),l.fillRect(27,27,46,46),l.moveTo(5,45),l.lineTo(50,3),l.lineTo(95,45),l.fill(),l.restore();const $a=Va(.3);l.fillStyle=la,l.fillRect(0,0,30,30),l.restore();const _a=Va(.3);l.fillStyle=ua,l.fillRect(0,0,30,30),l.restore();const ab=Va(1.4);l.scale(1.4,1.4),l.fillStyle=ua,Ta(),l.restore();const bb=document.createElement("canvas");bb.height=bb.width=600;const cb=bb.getContext("2d");cb.scale(100,100);const db=a=>{const b=C(a),c=z(a);cb.clearRect(0,0,9,9);for(let d=b;d--;)for(let b=c;b--;){cb.fillStyle=r(a,{x:d,y:b})?"#0000":"#000";const e=.12;cb.fillRect(b+e,d+e,1-2*e,1-2*e);for(let f=8;f--;){const g=n[f],h={x:g.x+d,y:g.y+b};!r(a,h)&&p(a,h)&&(0==g.x*g.y?cb.fillRect(b+e+.5*g.y,d+e+.5*g.x,1-2*e,1-2*e):!r(a,{x:d,y:b+g.y})&&!r(a,{x:d+g.x,y:b})&&!0&&cb.fillRect(b+e+.5*g.y,d+e+.5*g.x,1-2*e,1-2*e))}}};l.save(),J.forEach((a,c)=>{var e=Math.round,f=Math.PI;const g=C(a.d),i=z(a.d),h=za(i,g);Da(a.id,h),l.save(),l.translate(h[0]*xa,h[1]*xa),l.scale(xa/ya.I,xa/ya.I),l.beginPath(),l.rect(0,0,i,g),l.clip(),db(a.d),l.fillStyle=`hsl(${20+18*c},30%,${20+20*Math.random()}%)`,l.beginPath(),l.fillRect(0,0,9,9);for(let b=100;b--;){l.fillStyle=`hsl(${20+18*c},30%,${20+20*Math.random()}%)`;const a=50<b?1:1/4,d=e(4*(Math.random()*(i+a)-a))/4,f=e(4*(Math.random()*(g+a)-a))/4;l.beginPath(),l.fillRect(d,f,a,a)}l.globalCompositeOperation="destination-in",l.drawImage(bb,0,0,100*i,100*g,0,0,i,g),l.globalCompositeOperation="source-over";const j=.45,m=.3;a.j.forEach(({l:c})=>{const d=q.findIndex(b=>{const d={x:b.x+c.x,y:b.y+c.y};return p(a.d,d)&&!r(a.d,d)})||0,e=Za;l.save(),l.translate(c.y+.5+q[(d+3)%4].x*m,c.x+.5+q[(d+3)%4].y*m),l.rotate((d+3)*f/2),l.drawImage(wa,e[0]*xa,e[1]*xa,(e[2]-e[0])*xa,(e[5]-e[1])*xa,-j/2,-j/2,j,j),l.restore()}),a.i.forEach(({l:c})=>{const d=q.findIndex(b=>{const d={x:b.x+c.x,y:b.y+c.y};return p(a.d,d)&&!r(a.d,d)})||0,e=Za;l.save(),l.translate(c.y+.5+q[(d+1)%4].x*m,c.x+.5+q[(d+1)%4].y*m),l.rotate((d+1)*f/2),l.drawImage(wa,e[0]*xa,e[1]*xa,(e[2]-e[0])*xa,(e[5]-e[1])*xa,-j/2,-j/2,j,j),l.restore()});const k=Aa[a.h.j[0].k];for(let b=g;b--;)for(let e=i;e--;)if(3==u(a.d,{x:b,y:e})){const a=d({x:b,y:e}),c=.4;l.beginPath(),l.fillStyle="#fff6",l.arc(a.y,a.x,.32,0,2*f),l.fill(),l.filter="grayscale(90%)",l.drawImage(wa,k[0]*xa,k[1]*xa,(k[2]-k[0])*xa,(k[5]-k[1])*xa,a.y-c/2,a.x-c/2,c,c)}l.restore()}),l.restore();const eb=8,fb=3,gb=za(8,fb);Da("floor",gb),l.save(),l.scale(xa/ya.I,xa/ya.I),l.translate(gb[0]*ya.I,gb[1]*ya.I),l.beginPath();const hb=.01;l.rect(-hb,-hb,gb[2]*ya.I+2*hb,gb[3]*ya.I+2*hb),l.clip();const ib=1/4;l.scale(ib,ib);let s=0,y=0;for(;s<fb/ib;){for(y=0;y<32;){const a=Math.ceil(3+6*Math.random()),b=Math.floor(4*Math.random())/4;l.strokeStyle=l.fillStyle=`hsl(40,30%,${53+8*b}%)`,l.lineWidth=.1,l.beginPath(),l.fillRect(y,s,a,1),l.strokeRect(y,s,a,1),y+=a}const a=Math.ceil(1+2*Math.random());l.beginPath(),l.fillRect(0,s,a,1),l.strokeRect(0,s,a,1),s++}l.restore();const x=document.getElementById("a"),jb=document.getElementById("b"),kb=document.getElementById("c"),lb=document.getElementById("d"),mb=document.getElementById("e"),nb=document.getElementById("f"),ob=document.getElementById("g"),pb=document.getElementById("h"),qb=document.getElementById("i"),rb=document.getElementById("j"),sb=document.getElementById("k"),tb=document.getElementById("l"),ub=sb.getContext("2d");ub.scale(50,50),ub.translate(0,.5);const vb=rb.getContext("2d");vb.scale(100,100),vb.translate(.5,.5);const wb=(a,c,d)=>{var e=Math.PI;const f=Aa[a.id],b=C(a.d),g=z(a.d),h=Math.min(b,g);vb.save(),vb.filter=c?null:"grayscale(100%)",vb.rotate((4-d)%4*e/2),vb.drawImage(wa,f[0]*xa,f[1]*xa,(f[2]-f[0])*xa,(f[5]-f[1])*xa,-.5,-.5,h/b,h/g),vb.restore();const i=a=>a.forEach(({k:a,n:c})=>{const d=Aa[a];Array.from({length:c}).map(()=>{const a=.6;ub.translate(.4,0),ub.drawImage(wa,d[0]*xa,d[1]*xa,(d[2]-d[0])*xa,(d[5]-d[1])*xa,-a/2,-a/2,a,a),ub.fillStyle="#aaa",ub.beginPath(),ub.arc(0,0,.4,0,2*e),ub.fill()}),ub.translate(.45,0)});ub.save(),ub.filter=c?null:"grayscale(100%)",ub.globalCompositeOperation="destination-over",ub.translate(.05,0),i(a.h.i),ub.translate(.15,0);{ub.save(),ub.rotate(e/2);const a=.4,c=Za;ub.drawImage(wa,c[0]*xa,c[1]*xa,(c[2]-c[0])*xa,(c[5]-c[1])*xa,-a/2,-a/2,a,a),ub.restore()}ub.translate(.3,0),i(a.h.j),ub.restore()},xb=(a,b)=>{let d=0,f=null,g=!1;a.ontouchstart=a.onmousedown=a=>{if(!!a.touches)g=!0;else if(g)return;d=a.timeStamp,f=I(a)};const e=a=>{if(!!a.touches)g=!0;else if(g)return;d=0},h=a=>{if(!!a.touches)g=!0;else if(g)return;if(d&&f){const e=c(f,I(a));10<e&&(d=0,b())}};window.document.addEventListener("touchend",e),window.document.addEventListener("mouseup",e),window.document.addEventListener("touchmove",h),window.document.addEventListener("mousemove",h)};let yb,zb,Ab,Bb,Cb,Db,Eb;const Fb=(a,b)=>{if(!yb){yb=1,tb.onclick=()=>b.J=(b.J+3)%4;const c=c=>{b.K=c||b.K;const d=J.find(a=>a.id===b.K),e=d&&{id:Math.random().toString(),c:b.J,b:{x:-999,y:-999},e:d};d&&d.f>a.D||"Worker"===b.K&&V>a.D||(b.F=e,b.B="Worker"===b.K&&{id:Math.random().toString(),o:{x:-999,y:-999},L:{x:0,y:0},M:0,m:{v:4}})};xb(rb,c),kb.onclick=()=>{b.p=null,b.m=null},jb.onclick=()=>b.E=!0,ob.onclick=()=>b.E=!1,mb.onmousedown=mb.ontouchstart=x.ontouchstart=x.onmousedown=a=>a.stopPropagation(),[{id:"Worker"},...J].forEach(a=>{const d=document.createElement("div");d.style.cssText="padding:10px;cursor:pointer;",d.innerText=a.id,d.onclick=()=>b.K=a.id,xb(d,()=>c(a.id)),nb.appendChild(d)})}const c=!b.B&&!b.F&&!b.m&&!!b.E,d=b.m,e=12<=b.step;if((Ab!==c||Bb!=d||Eb!=e)&&(Ab=c,Bb=d,Eb=e,mb.style.transform=Ab?null:"scale(0,0)",x.style.transform=Ab?"translate3d(0,100px,0)":null,lb.style.display=jb.style.display=Bb||!e?"none":"block",kb.style.display=Bb?"block":"none"),zb!==a.D||Db!=b.J||Cb!=b.K){lb.innerText="$"+(zb=a.D),pb.innerText=Cb=b.K;const c=J.find(a=>a.id===Cb);if(sb.style.display="none",rb.style.display="none",tb.style.display="none",vb.clearRect(-1,-1,2,2),ub.clearRect(-1,-1,10,10),vb.save(),c){qb.innerText="$"+c.f;const a=c.f<=zb;qb.style.opacity=a?1:.3,qb.style.textDecoration=a?null:"line-through",wb(c,a,Db=b.J),sb.style.display="block",rb.style.display="block",tb.style.display="block"}else if("Worker"===Cb){const a=Aa[100];qb.innerText="$"+V;const b=V<=zb;qb.style.opacity=b?1:.3,qb.style.textDecoration=b?null:"line-through",vb.filter=b?null:"grayscale(100%)",vb.drawImage(wa,a[0]*xa,a[1]*xa,(a[2]-a[0])*xa,(a[5]-a[1])*xa,-.3,-.3,.6,.6),rb.style.display="block"}vb.restore()}},Gb=["Oh no, your Sushi Kitchen went offline!<br>&nbsp; Let's restart over shall we?","See this guy over here?<br>&nbsp;Put him to work!","Click on the little guy","And point him the machine on top",0,"Look at that! He got a rice grain!","Make him carry that to the hungry customers<br> on the left","Select him again","Draw a path<br>from the collect point to the drop point",0,"Well done!","Keep going<br>You can recruit crew and build new machines from the shop<br>&nbsp; Look up for new recipes"],Hb=document.getElementById("m"),Ib=document.getElementById("n"),Jb=document.getElementById("o");let Kb,Lb;const Mb=(a,b)=>{if(Hb.ontouchstart=Hb.onmousedown=Hb.onmousedown||(a=>a.stopPropagation()),Hb.onclick=Hb.onclick||(()=>b.step++),(2==Kb||7==Kb)&&b.m&&b.step++,3==Kb&&3==a.n[0].m.v&&b.step++,3!=Kb||b.m||3===a.n[0].m.v||b.step--,4==Kb&&a.t[0]&&(b.step++,a.n[0].m.v=4),6==Kb&&!a.N.length){const b=C(a.map);a.O=[{l:{x:b-1,y:4}},{l:{x:b-1,y:5}},{l:{x:b-1,y:6}}],a.N=Array.from({length:8}).map((b,c)=>({id:""+c,M:0,P:1,o:{x:a.O[0].l.x+.2+.05*c-2,y:a.O[0].l.y+.1+.05*c+4},L:{x:0,y:0},m:{v:3,Q:a.O[0].l},r:{R:0}}))}8!=Kb&&9!=Kb||b.m||2===a.n[0].m.v&&a.O.some(({l:b})=>f(b,e(a.n[0].m.A)))||(3===a.n[0].m.v&&(a.n[0].m.v=4),b.step=7),8==Kb&&2===a.n[0].m.v&&a.O.some(({l:b})=>f(b,e(a.n[0].m.A)))&&b.step++,9==Kb&&a.t[0]&&a.O.some(({l:b})=>f(b,e(a.t[0].o)))&&b.step++;const c=!b.B&&!b.F&&!b.m&&!!b.E;Lb!==c&&(Lb=c,Jb.style.transform=Lb?"translate3d(0,-280px,0)":"translate3d(0,-60px,0)",12<=Kb&&(Jb.innerText="drag and drop machine or worker",Jb.style.display=Lb&&4>a.n.length+a.q.length?"block":"none")),b.step!==Kb&&(Kb=b.step,[0,1,5,6,10,11].includes(Kb)?(Ib.innerHTML=Gb[Kb],Hb.style.display="flex"):Hb.style.display="none",[2,3,7,8].includes(Kb)?(Jb.innerHTML=Gb[Kb],Jb.style.display="block"):Jb.style.display="none")},Nb=(a,b,c)=>{const d=a.createShader(c);return a.shaderSource(d,b),a.compileShader(d),d},Ob=(a,b,c)=>{const d=Nb(a,b,a.VERTEX_SHADER),e=Nb(a,c,a.FRAGMENT_SHADER),f=a.createProgram();return a.attachShader(f,d),a.attachShader(f,e),a.linkProgram(f),f},Pb=(a,b,c,d=1)=>{const e=a.createBuffer(),f=a.getAttribLocation(b,c);return a.enableVertexAttribArray(f),{S:b=>{a.bindBuffer(a.ARRAY_BUFFER,e),a.bufferData(a.ARRAY_BUFFER,Float32Array.from(b),a.STATIC_DRAW),a.vertexAttribPointer(f,d,a.FLOAT,!1,0,0)},bind:()=>{a.bindBuffer(a.ARRAY_BUFFER,e),a.vertexAttribPointer(f,d,a.FLOAT,!1,0,0)}}},Qb=a=>{const b=a.createBuffer();return{S:c=>{a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,b),a.bufferData(a.ELEMENT_ARRAY_BUFFER,new Uint16Array(c),a.STATIC_DRAW)},bind:()=>{a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,b)}}},Rb=(a,b,c,d)=>{let e;const f=a.getUniformLocation(b,c);let g;return"mat4"===d?g=()=>a.uniformMatrix4fv(f,!1,new Float32Array(e)):"vec3"===d?g=()=>a.uniform3fv(f,e):void 0,{S:a=>{e=a},bind:g}},Sb=(a,b,c)=>{const d=a.createTexture(),e=a.getUniformLocation(b,c);return{S:b=>{a.bindTexture(a.TEXTURE_2D,d),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,b),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR),a.generateMipmap(a.TEXTURE_2D),a.bindTexture(a.TEXTURE_2D,null)},bind:()=>{a.activeTexture(a.TEXTURE0),a.bindTexture(a.TEXTURE_2D,d),a.uniform1i(e,0)}}},Tb=(a,b,c,d=1)=>(e,f,g,h)=>(i,j={x:0,y:1})=>{const l=e.length/2,k={x:j.y,y:-j.x};e.push(i.x-k.x*a-j.x*b,i.y-k.y*a-j.y*b,i.x+k.x*a-j.x*b,i.y+k.y*a-j.y*b,i.x+k.x*a+j.x*b,i.y+k.y*a+j.y*b,i.x-k.x*a+j.x*b,i.y-k.y*a+j.y*b),g.push(d,d,d,d),f.push(...c),h.push(l+0,l+1,l+2,l+0,l+2,l+3)},Ub=(a,b,d,e)=>(f,h,i,j)=>{const k={x:b.x-a.x,y:b.y-a.y},l=g(k),m={x:.5*(b.x+a.x),y:.5*(b.y+a.y)},c={x:k.y/l,y:-k.x/l};Tb(l/2+.02,.05,d,e)(f,h,i,j)(m,c)},Vb=(a,b,c)=>(d,e,f,g)=>1==a.length?Ub(a[0],{x:a[0].x+.05,y:a[0].y},b,c)(d,e,f,g):a.forEach((h,j)=>0<j&&Ub(a[j-1],h,b,c)(d,e,f,g)),Wb=(b,c=1)=>(e,f,g,i)=>{var a=Math.min,j=Math.max;const{id:k,i:l,j:m,d:n}=b.e,o=q[(b.c+4)%4],r=C(n),s=z(n),h=H(b),p=h({x:0,y:0}),t=h({x:r,y:s}),v={x:a(p.x,t.x),y:a(p.y,t.y)},w={x:j(p.x,t.x),y:j(p.y,t.y)},x={x:(v.x+w.x)/2+(-1==o.x+o.y),y:(v.y+w.y)/2+(1==o.x-o.y)};Tb(s/2,r/2,Aa[k],c)(e,f,g,i)(x,o);for(let h=r;h--;)for(let l=s;l--;)if(3==u(n,{x:h,y:l})){const n=b.T?j(0,b.T.U)/U:0,a=(b.T?b.T.V:0)/b.e.g,k=.2*(1+.8*n),o=.55*(1+.2*n);Tb(o,o,Xa,.4*c)(e,f,g,i)(d(H(b)({x:h,y:l}))),Tb(k,k,Aa[m[0].k+10],c)(e,f,g,i)(d(H(b)({x:h,y:l}))),Tb(k,k,Aa[m[0].k],a*c)(e,f,g,i)(d(H(b)({x:h,y:l})))}},Xb=a=>(b,c,e,f)=>{a.q.forEach(a=>Wb(a)(b,c,e,f));const g=.3;a.O.forEach(({l:a})=>Tb(g,g,Za)(b,c,e,f)(d(a),{x:-1,y:0}))},Yb=.014,Zb=(a,c=100)=>(d,e,f,i)=>{const{o:j,L:l}=a,m=g(l),n=m<Yb?{x:0,y:1}:{x:l.x/m,y:l.y/m};let o=-1,r=0;q.find((a,b)=>{const c=a.x*n.x+a.y*n.y;o<c&&(o=c,r=b)});const p=.08*Math.sin(12*a.M)*Math.min(m,.01)/.01;if(Tb(.3,.3,Aa[c+r])(d,e,f,i)({x:j.x,y:j.y-.26+p}),a.r&&a.r.s){const g=a.r.s,h=b(l),k={x:j.x-.24*h.x,y:j.y-.24*h.y};Tb(.25,.25,Aa[g])(d,e,f,i)(k)}},$b=(a,b=!1)=>(c,d,e,f)=>{const{o:h,L:i}=a,j=g(i),k=j<Yb?{x:0,y:1}:{x:i.x/j,y:i.y/j},l={x:-k.x,y:-k.y},m=b?.6:.34,n=b?ab:j<Yb?Wa:Ya;Tb(m,m,n)(c,d,e,f)(h,l)},_b=a=>(b,c,d,e)=>{const f=[...a.n,...a.N].sort((c,a)=>c.o.y-a.o.y);a.n.forEach(a=>$b(a)(b,c,d,e)),f.forEach(a=>Zb(a,a.P?300:100)(b,c,d,e))};let ac=0;const bc=(a,b)=>(c,e,f,g)=>{const h=b.m||b.B||b.F,i=h?44:0;ac!==i&&(ac=Math.round(ac+(ac<i?4:-4))),Tb(100,100,$a,ac/100)(c,e,f,g)({x:0,y:0}),b.B&&Tb(.3,.3,Aa[100],b.C?.8:.1)(c,e,f,g)({x:b.B.o.x,y:b.B.o.y-.3});const j=!b.B&&!b.F&&a.n.find(a=>a.id===b.p);j&&a.q.forEach(i=>{const k=C(i.e.d),l=z(i.e.d),h=j.m.w===i.id?.82:.5;for(let a=k;a--;)for(let b=l;b--;)r(i.e.d,{x:a,y:b})||Tb(.5,.5,_a,h)(c,e,f,g)(d(H(i)({x:a,y:b})));$b(j,!0)(c,e,f,g);let m,n;if(2===j.m.v&&(m=j.m.z,n=j.m.A),b.m&&b.m.A&&(m=b.m.z,n=b.m.A),m){const b=E(a.map,G(a.map,m,n)||[]).map(d);Vb(b,_a,1)(c,e,f,g)}Zb(j)(c,e,f,g)}),b.F&&Wb(b.F,b.G?.8:.1)(c,e,f,g)},cc=10,dc=4,ec=a=>(b,c,d,e)=>{const f=C(a.map),g=z(a.map);for(let h=f;h--;)for(let f=g;f--;)if(o(a.map,{x:h,y:f})){let a=(h+3*f+f*f)%cc,g=(f+0*f)%dc;const i=[gb[0]+a*gb[2]/cc,gb[1]+g*gb[3]/dc,gb[2]/cc,gb[3]/dc];Tb(.5,.5,Ca(i))(b,c,d,e)({x:h+.5,y:f+.5})}};var fc="precision highp float;varying highp vec2 a;varying highp float b;uniform sampler2D c;void main(void) { gl_FragColor = texture2D(c, vec2(a.s, a.t)); gl_FragColor.a = gl_FragColor.a * b;}",gc="precision highp float;attribute vec2 e;attribute vec2 f;attribute float g;uniform mat4 d;varying vec2 a;varying float b;void main(void) { gl_Position = d * vec4(e, 0.0, 1.0); a = f; b = g;}";const hc=a=>{const b=Ob(a,gc,fc),c=Pb(a,b,"e",2),d=Rb(a,b,"d","mat4"),e=Pb(a,b,"g",1),f=Pb(a,b,"f",2),g=Sb(a,b,"c"),h=Qb(a,b);return a.useProgram(b),g.S(wa),g.bind(),(b,g,i)=>{const j=[],k=[],l=[],m=[];ec(b,g)(j,l,k,m),Xb(b,g)(j,l,k,m),b.t.forEach(({k:a,o:b})=>Tb(.25,.25,Aa[a])(j,l,k,m)(b)),_b(b,g)(j,l,k,m),bc(b,g)(j,l,k,m),d.S(i),f.S(l),h.S(m),e.S(k),c.S(j),d.bind(),a.drawElements(a.TRIANGLES,m.length,a.UNSIGNED_SHORT,0)}},ic={alpha:!0,W:!0,X:!1},jc=window.devicePixelRatio||1,kc=a=>{a.width=a.clientWidth*jc,a.height=a.clientHeight*jc;const b=a.getContext("webgl2",ic)||a.getContext("webgl",ic);return b.clearColor(150/255,105/255,79/255,1),b.viewport(0,0,b.drawingBufferWidth,b.drawingBufferHeight),b.enable(b.BLEND),b.blendEquationSeparate(b.FUNC_ADD,b.FUNC_ADD),b.blendFunc(b.SRC_ALPHA,b.ONE_MINUS_SRC_ALPHA),b},lc=b=>{const c=C(b),d=z(b),e=window.innerWidth,f=window.innerHeight,g=Math.min(e/c,f/d),h=e/g,i=f/g,j=1;return[2*j/h,0,0,0,0,2*-j/i,0,0,0,0,1,0,j*(-1+1*(h-c)/h),-j*(-1+1*(i-d)/i),0,1]},mc=a=>{const b=kc(a),c=hc(b);let d;return window.addEventListener("resize",()=>{a.width=a.clientWidth*jc,a.height=a.clientHeight*jc,b.viewport(0,0,b.drawingBufferWidth,b.drawingBufferHeight),d=null}),(a,e)=>{d=d||lc(a.map),b.clear(b.COLOR_BUFFER_BIT),c(a,e,d)}},nc=1e-4,oc=a=>Math.round(1e4*a)/1e4,pc=(a,b,c,d)=>{if(!b.Y){const f=G(a,e(c),e(b.Q));if(!f)return d.m={v:4},d.y=null,void(d.r=null);b.Y=f.map(({x:a,y:b})=>({x:a+.5,y:b+.5})),b.Y[b.Y.length-1]=b.Q}for(const e=b=>m(b=>r(a,b),c,b);b.Y&&b.Y[1]&&e(b.Y[1]);)b.Y.shift()},qc=({map:f,n:a,N:b})=>{var c=Math.min,h=Math.max;const d=[...a,...b],j=d.map(b=>{const{L:i,o:j,y:k}=b,m=e(j),o={x:0,y:0};if(o.x+=-K*i.x,o.y+=-K*i.y,k&&pc(f,k,j,b),b.y&&k.Y){const a=k.Y[0],b={x:a.x-j.x,y:a.y-j.y},d=g(b),e=c(L,d);d>nc&&(o.x+=b.x/d*e,o.y+=b.y/d*e)}const a={x:0,y:0};d.forEach(c=>{if(j!==c.o){const b={x:c.o.x-j.x,y:c.o.y-j.y},d=h(g(b),N);if(1<d)return;a.x-=b.x/d/d/d*M,a.y-=b.y/d/d/d*M}});const l=g(a),p=c(l,.0025);return 1e-4<l&&(o.x+=a.x/l*p,o.y+=a.y/l*p),r(f,m)&&n.forEach(a=>{const e={x:m.x+a.x,y:m.y+a.y};if(r(f,e))return;if(0!=a.x*a.y&&(!r(f,{x:m.x+a.x,y:m.y})||!r(f,{x:m.x,y:m.y+a.y})))return;const b={x:e.x+.5-.5*a.x,y:e.y+.5-.5*a.y},c={x:b.x-j.x,y:b.y-j.y};let d=0==a.x*a.y?c.x*a.x+c.y*a.y:g(c);d=h(d,.1),.4<d&&(d=10),o.x-=a.x*a.x*(c.x/d/d/d)*O,o.y-=a.y*a.y*(c.y/d/d/d)*O}),o});d.forEach((a,b)=>{a.L.x+=j[b].x,a.L.y+=j[b].y;const c=g(a.L);a.M=c+a.M,a.o.x+=a.L.x,a.o.y+=a.L.y,a.o.x=oc(a.o.x),a.o.y=oc(a.o.y)})},rc=a=>b=>a.splice(a.indexOf(b),1),sc=(a,b)=>{const{h:c,i:d,j:g}=a.e,h=H(a),i={};d.forEach(({l:a,k:g})=>{const j=h(a);b.forEach(a=>{0>=a.u&&g===a.k&&f(j,e(a.o))&&(i[a.k]=i[a.k]||[]).push(a)})}),c.i.every(({k:a,n:b})=>i[a]&&i[a].length>=b)&&(c.i.forEach(({k:a,n:c})=>i[a].slice(0,c).forEach(rc(b))),a.T={V:0,U:0})},tc=(a,b)=>{const{h:c,j:d,g:e}=a.e;if(0<a.T.U&&a.T.U--,a.T.V>e){a.T=null;const e=H(a);c.j.forEach(({k:a,n:f})=>{const{l:g}=d.find(b=>b.k===a),h=e(g);for(;f--;)b.push({k:a,o:{x:h.x+.5+.3*(Math.random()-.5),y:h.y+.5+.3*(Math.random()-.5)},u:Q})})}},uc=({q:a,t:b})=>a.forEach(a=>{a.T||sc(a,b),a.T&&tc(a,b)}),vc=a=>a.O.forEach(({l:b})=>{for(let c=a.t.length;c--;){const{k:d,o:g,u:h}=a.t[c];a.Z[d]&&0>=h&&f(e(g),b)&&(a.t.splice(c,1),a.D+=a.Z[d])}}),wc=({map:a,q:b},e)=>{const f=b.find(({id:a})=>a===e.m.w);if(f){e.r._&&e.r._--,0>=e.r._&&(e.y=null);const b=e.r.x<S;if(b&&!e.y){const b=B(a,f,e.o,.02);if(!b)return void(e.m.v=4);e.y={Q:b},e.r._=120}if(!b&&e.y&&(e.y=null),0>=e.r.x&&f.T&&0>=f.T.U){const b=B(a,f,e.o,.08);if(!b)return void(e.m.v=4);const g=c(b,e.o);g<T&&(e.y=null,f.T.V++,f.T.U=U,e.r.x=R)}e.r.x--}},xc=({O:a},b)=>{if(!b.r||0>b.r.R){const{l:c}=a[Math.floor(Math.random()*a.length)],d={x:c.x+Math.random(),y:c.y+Math.random()};b.m.Q=d,b.y={Q:d},b.r={R:20+50*Math.random()}}else b.r.R--},yc=(a,b)=>{if(!b.r.s&&f(b.m.z,e(b.o))){const c=a.t.findIndex(a=>0>=a.u&&f(e(a.o),e(b.o)));if(0<=c){const[{k:d}]=a.t.splice(c,1);b.r.s=d}}if(b.r.s&&i(b.o,{x:b.m.A.x+.5,y:b.m.A.y+.5})<.3*.3){const c=b.r.s,d={x:.3+.4*Math.random()+b.m.A.x,y:.3+.4*Math.random()+b.m.A.y};a.t.push({k:c,o:d,u:Q}),b.r.s=null}!b.r.s||b.y&&f(e(b.y.Q),b.m.A)||(b.y={Q:{x:b.m.A.x+.5,y:b.m.A.y+.5}}),b.r.s||b.y&&f(e(b.y.Q),b.m.z)||(b.y={Q:{x:b.m.z.x+.5,y:b.m.z.y+.5}})},zc=a=>{a.n.forEach(b=>{switch(b.m.v){case 2:return yc(a,b);case 3:return wc(a,b);}}),a.N.forEach(b=>xc(a,b))},Ac=a=>{a.t.forEach(a=>{0<a.u&&a.u--}),zc(a),qc(a),uc(a),vc(a)},Bc=14,w=12,h=Array.from({length:w+1}).map((a,b)=>Array.from({length:Bc}).map(()=>b>=w?1:0));h[1][8]=3,h[1][9]=3,h[1][10]=3,h[2][10]=3,h[2][8]=2,h[4][Bc-1]=2,h[5][Bc-1]=2,h[6][Bc-1]=2,h[0][0]=1,h[0][1]=1,h[0][4]=1,h[7][0]=1,h[8][0]=1,h[9][0]=1,h[11][0]=1,h[0][Bc-2]=1,h[1][Bc-2]=1,h[0][Bc-1]=1,h[1][Bc-1]=1,h[2][Bc-1]=1,h[3][Bc-1]=1,h[10][Bc-1]=1,h[7][Bc-1]=1,h[8][Bc-1]=1,h[9][Bc-1]=1,h[6][0]=1,h[6][1]=1,h[6][2]=1,h[6][3]=1,h[6][4]=1,h[5][9]=1,h[9][9]=1,h[8][9]=1,h[7][9]=1,h[6][9]=1,h[6][10]=1,h[4][10]=1,h[5][10]=1,h[7][10]=1;const Cc={D:960,map:h,n:[{id:"1",o:{x:8.3,y:6.5},L:{x:0,y:0},M:0,m:{v:4},r:null,y:null}],N:[],Z:P,$:J,O:[],q:[{id:"1",b:{x:8,y:1},c:0,e:J[0],T:{V:J[0].g-1,U:0}}],t:[],$:[]},Dc={J:0,K:J[1].id,step:0},Ec=document.getElementById("u"),Fc=mc(Ec);ja(document.body,Cc,Dc);const Gc=()=>{Ac(Cc),Fc(Cc,Dc),Fb(Cc,Dc),Mb(Cc,Dc),requestAnimationFrame(Gc)};Gc();
</script></body></html>